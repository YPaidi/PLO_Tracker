<!DOCTYPE html>
<html>
<head>
    <title>Program Learning Outcomes Tracker - Bachelor of East Asian Studies</title>
    <style>
        .container {
            display: flex;
            justify-content: space-around;
            padding: 20px;
        }
        .courses, .selected-courses, .clo-cognitive, .clo-psychomotor, .clo-affective, .plo-results {
            width: 18%;
            min-height: 300px;
            border: 2px dashed #ccc;
            padding: 10px;
        }
        .course-item {
            padding: 8px;
            margin: 5px;
            background-color: lightblue;
            cursor: grab;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="courses.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Checking if courses.js is loaded...");

        setTimeout(function () {
            if (typeof window.courses !== "undefined" && Object.keys(window.courses).length > 0) {
                console.log("Courses loaded successfully:", window.courses);

                let courseList = document.getElementById("course-list");
                courseList.innerHTML = "";

                Object.keys(window.courses).forEach(courseId => {
                    let courseDiv = document.createElement("div");
                    courseDiv.className = "course-item";
                    courseDiv.draggable = true;
                    courseDiv.id = courseId;
                    courseDiv.textContent = window.courses[courseId]["title"];
                    courseDiv.addEventListener("dragstart", drag);
                    courseList.appendChild(courseDiv);
                });
            } else {
                console.error("courses.js did not load properly. Please check the file.");
            }
        }, 500);
    });
</script>
<body>
    <h1 style="text-align: center;">Program Learning Outcomes Tracker</h1>
    <h2 style="text-align: center;">Bachelor of East Asian Studies</h2>
    <div class="container">
        <!-- Available Courses -->
        <div class="courses" ondragover="allowDrop(event)" ondrop="dropBack(event)">
            <h3>Available Courses (A-Z)</h3>
            <div id="course-list"></div>
        </div>
        
        <!-- Selected Courses -->
        <div class="selected-courses" ondragover="allowDrop(event)" ondrop="drop(event)">
            <h3>Selected Courses</h3>
        </div>
        
        <!-- Achieved CLOs - Cognitive -->
        <div class="clo-cognitive">
            <h3>Cognitive CLOs</h3>
            <ul id="cognitive-list"></ul>
        </div>
        
        <!-- Achieved CLOs - Psychomotor -->
        <div class="clo-psychomotor">
            <h3>Psychomotor CLOs</h3>
            <ul id="psychomotor-list"></ul>
        </div>
        
        <!-- Achieved CLOs - Affective -->
        <div class="clo-affective">
            <h3>Affective CLOs</h3>
            <ul id="affective-list"></ul>
        </div>
        
        <!-- Achieved PLOs -->
        <div class="plo-results">
            <h3>Achieved PLOs</h3>
            <ul id="plo-list"></ul>
        </div>
    </div>

    <div style="width: 50%; margin: auto;">
        <canvas id="ploBarChart"></canvas>
    </div>

    <footer>
        Developed by Rohayati Paidi
    </footer>

    <script>
        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function drop(event) {
            event.preventDefault();
            let data = event.dataTransfer.getData("text");
            let element = document.getElementById(data);
            if (!document.getElementById("selected-" + data)) {
                let clone = element.cloneNode(true);
                clone.id = "selected-" + data;
                clone.setAttribute("draggable", "true");
                clone.addEventListener("dragstart", drag);
                clone.addEventListener("dblclick", removeCourse);
                event.target.appendChild(clone);
                displayResults();
            }
        }

        function dropBack(event) {
            event.preventDefault();
            let data = event.dataTransfer.getData("text");
            let element = document.getElementById(data);
            if (element && element.parentNode.classList.contains("selected-courses")) {
                element.remove();
                displayResults();
            }
        }

        function removeCourse(event) {
            event.target.remove();
            displayResults();
        }

        let ploBarChart;

        function displayResults() {
            let selectedCourses = document.querySelector(".selected-courses").children;
            let cognitiveList = document.getElementById("cognitive-list");
            let psychomotorList = document.getElementById("psychomotor-list");
            let affectiveList = document.getElementById("affective-list");
            let ploList = document.getElementById("plo-list");

            cognitiveList.innerHTML = "";
            psychomotorList.innerHTML = "";
            affectiveList.innerHTML = "";
            ploList.innerHTML = "";

            let achievedPLOs = {
                "PLO01": 0, "PLO02": 0, "PLO03": 0, "PLO04": 0, "PLO05": 0, 
                "PLO06": 0, "PLO07": 0, "PLO08": 0, "PLO09": 0, "PLO10": 0, "PLO11": 0
            };

            for (let i = 1; i < selectedCourses.length; i++) {
                let courseId = selectedCourses[i].id.replace("selected-", "");
                if (window.courses[courseId]) {
                    Object.keys(window.courses[courseId]["CLOs"]).forEach(category => {
                        window.courses[courseId]["CLOs"][category].forEach(clo => {
                            let cloItem = document.createElement("li");
                            cloItem.textContent = clo;
                            if (category === "Cognitive") cognitiveList.appendChild(cloItem);
                            if (category === "Psychomotor") psychomotorList.appendChild(cloItem);
                            if (category === "Affective") affectiveList.appendChild(cloItem);

                            let cloKey = clo.split(":")[0];
                            if (window.ploMapping[cloKey]) {
                                let ploKey = window.ploMapping[cloKey];
                                achievedPLOs[ploKey] += 1;
                            }
                        });
                    });
                }
            }

            Object.keys(achievedPLOs).sort().forEach(plo => {
                let ploItem = document.createElement("li");
                ploItem.textContent = `${plo} (Achieved ${achievedPLOs[plo]} times)`;
                ploList.appendChild(ploItem);
            });

            updateBarChart(achievedPLOs);
        }

        function updateBarChart(achievedPLOs) {
            let ctx = document.getElementById("ploBarChart").getContext("2d");
            let ploLabels = Object.keys(achievedPLOs).sort();
            let ploData = ploLabels.map(plo => achievedPLOs[plo]);

            if (ploBarChart) {
                ploBarChart.destroy();
            }

            ploBarChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ploLabels,
                    datasets: [{
                        label: "PLO Achievement",
                        data: ploData,
                        backgroundColor: "rgba(54, 162, 235, 0.6)",
                        borderColor: "rgba(54, 162, 235, 1)",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            suggestedMax: 5
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
